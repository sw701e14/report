\section{Generating the Model}\label{sec:generatemarkov}
The Markov chain $\mathcal{M}$, described in \Cref{markov}, is generated by the steps detailed in this section.
The algorithm takes a set of hotspots $H$ and a set of GPS data $G$, where $g \in G$ represents a single bike location update. For each hotspot $h \in H$ there exists a departure state $D_h$.
The result of the algorithm is a matrix with the probabilities for all possible transactions.

\begin{algorithm}[H]
\SetAlgoNoEnd
\textbf{CreateModel($H, G$)} \\
Let $M$ be an empty $n \times n$ matrix with $n = 2|H|$ \\
Let $G'$ be an abstraction of $G$, so that for each $g_{b_i} \in G'$ we have the location for bike $b$ at time $i$, in ascending order by time\\
Let $L$ be a set, so that $L_b$ denotes the latest state of bike $b$ (initially based on its latest hotspot)\\
\ForEach{$g_{b_i} \in G'$}
    {Let $loc \leftarrow $ determined state of $g_{b_i}$\\
      \If{$L_b \in H \land loc \not\in H$}
      {Let $s \leftarrow D_{L_b}$}
    \Else{Let $s \leftarrow loc$}
    Transition $L_b \rightarrow loc$ is added to $M$\\
     $L_b \leftarrow s$}
Normalize $M$\\
\Return{M}
\caption{Creating the model.}
\label{markov:create_model}
\end{algorithm}