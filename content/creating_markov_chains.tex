\section{Generating the Model}\label{sec:generatemarkov}
The Markov chain $\mathcal{M}$, described in \cref{markov}, is generated by the steps detailed in this section.
The algorithm takes a set of hotspots $H$ and a set of GPS data $G$. For each hotspot in $H$ there exists a departure state $D_h$.
The result of the algorithm is a matrix with the probabilities for all possible transactions.

\begin{algorithm}[H]
\textbf{create\_model($H, G$)} \\
Let $M$ be an empty $n \times n$ matrix with $n = 2|H|$ \\
Let $S$ be a grouping of $G$, so that for each $S_i$ we have all bike states (determined by location) for state $i$\\
Let $L$ be a set of the latest state for each bike, initialized with its latest state\\
\For{each grouped state $s$ in $S$}
  {\For{each bike $b$ in $s$}
    {$n \leftarrow s_b$\\
    \If{$L_b$ is a hotspot and $s_b$ is not}{$n \leftarrow D_{s_b}$}The transition $L_b \rightarrow s$ is added to $M$\\
     $L_b \leftarrow n$}}
$M$ is normalized.\\
\Return{M}
\caption{Creating the model.}
\label{markov:create_model}
\end{algorithm}